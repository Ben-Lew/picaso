<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>3D Spectra &mdash; picaso 3.2 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b76e3c8a" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=720011df" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/documentation_options.js?v=828ea960"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Phase Curves Part 1" href="9e_PhaseCurves.html" />
    <link rel="prev" title="Post-Process 3D Clouds Input" href="9c_PostProcess3Dinput-Clouds.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            picaso
          </a>
              <div class="version">
                3.2
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../tutorials.html">The Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html#basics-of-reflected-light">Basics of Reflected Light</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html#basics-of-transmisison">Basics of Transmisison</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html#basics-of-thermal-emission">Basics of Thermal Emission</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html#cloud-modeling-with-virga">Cloud Modeling with <cite>Virga</cite></a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../tutorials.html#moving-to-3-dimensions">Moving to 3 Dimensions</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="8_SphericalIntegration.html">Non-Zero Phase and Spherical Integration</a></li>
<li class="toctree-l3"><a class="reference internal" href="9a_3DInputsWithPICASOandXarray.html">Basics of a 3D Calculation</a></li>
<li class="toctree-l3"><a class="reference internal" href="9b_PostProcess3Dinput-Chemistry.html">What is post-processing?</a></li>
<li class="toctree-l3"><a class="reference internal" href="9b_PostProcess3Dinput-Chemistry.html#Post-Process-3D-Chemistry-Input">Post-Process 3D Chemistry Input</a></li>
<li class="toctree-l3"><a class="reference internal" href="9c_PostProcess3Dinput-Clouds.html">Post-Processing Clouds for 3D runs</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Modeling a 3D Spectrum (Adams et al. 2022)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Run-Cloud-Free-3D-Spectra">Run Cloud-Free 3D Spectra</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Analyze-3D-Spectra">Analyze 3D Spectra</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Run-Cloudy-3D-Spectra">Run Cloudy 3D Spectra</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="9e_PhaseCurves.html">Modeling a Phase Curve pt 1 (Robbins-Blanch et al. 2022)</a></li>
<li class="toctree-l3"><a class="reference internal" href="9f_PhaseCurves-wChemEq.html">Modeling a Phase Curve pt 2 (Robbins-Blanch et al. 2022)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html#d-climate-modeling">1D Climate Modeling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html#fitting-models-to-data">Fitting models to data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html#model-storage-reuse">Model Storage &amp; Reuse</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html#opacities">Opacities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html#radiative-transfer-techniques">Radiative Transfer Techniques</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html#faqs">FAQs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html#code-help">Code Help</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html#references">References</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../picaso.html">The Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contribution.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../workshops.html">Workshop Material</a></li>
<li class="toctree-l1"><a class="reference external" href="https://natashabatalha.github.io/picaso_dev">The Derivations</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/natashabatalha/picaso">Github</a></li>
<li class="toctree-l1"><a class="reference internal" href="../credit.html">What to Cite</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">picaso</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../tutorials.html">Tutorials</a></li>
      <li class="breadcrumb-item active">3D Spectra</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/notebooks/9d_3DSpectra.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://github.com/natashabatalha/picaso/tree/master/docs/notebooks/9d_3DSpectra.ipynb">Download full notebook here</a></p>
</div>
<section id="3D-Spectra">
<h1>3D Spectra<a class="headerlink" href="#3D-Spectra" title="Link to this heading">¶</a></h1>
<p>From the previous two tutorials you should understand how:</p>
<ol class="arabic simple">
<li><p>How to convert your GCM input to <code class="docutils literal notranslate"><span class="pre">PICASO</span></code>’s required <code class="docutils literal notranslate"><span class="pre">xarray</span></code></p></li>
<li><p>How to post-process output to append to your GCM output</p></li>
</ol>
<p>Here you will learn:</p>
<ol class="arabic simple">
<li><p>How to run a 3D spectrum</p></li>
<li><p>How to analyze the resulting output</p></li>
</ol>
<p><strong>Citation:</strong> <a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2022ApJ...926..157A/abstract">Adams et al. 2022 “Spatially Resolved Modeling of Optical Albedos for a Sample of Six Hot Jupiters” ApJ</a></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">picaso</span> <span class="kn">import</span> <span class="n">justdoit</span> <span class="k">as</span> <span class="n">jdi</span>
<span class="kn">from</span> <span class="nn">picaso</span> <span class="kn">import</span> <span class="n">justplotit</span> <span class="k">as</span> <span class="n">jpi</span>
<span class="n">jpi</span><span class="o">.</span><span class="n">output_notebook</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<style>
        .bk-notebook-logo {
            display: block;
            width: 20px;
            height: 20px;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAABx0RVh0U29mdHdhcmUAQWRvYmUgRmlyZXdvcmtzIENTNui8sowAAAOkSURBVDiNjZRtaJVlGMd/1/08zzln5zjP1LWcU9N0NkN8m2CYjpgQYQXqSs0I84OLIC0hkEKoPtiH3gmKoiJDU7QpLgoLjLIQCpEsNJ1vqUOdO7ppbuec5+V+rj4ctwzd8IIbbi6u+8f1539dt3A78eXC7QizUF7gyV1fD1Yqg4JWz84yffhm0qkFqBogB9rM8tZdtwVsPUhWhGcFJngGeWrPzHm5oaMmkfEg1usvLFyc8jLRqDOMru7AyC8saQr7GG7f5fvDeH7Ej8CM66nIF+8yngt6HWaKh7k49Soy9nXurCi1o3qUbS3zWfrYeQDTB/Qj6kX6Ybhw4B+bOYoLKCC9H3Nu/leUTZ1JdRWkkn2ldcCamzrcf47KKXdAJllSlxAOkRgyHsGC/zRday5Qld9DyoM4/q/rUoy/CXh3jzOu3bHUVZeU+DEn8FInkPBFlu3+nW3Nw0mk6vCDiWg8CeJaxEwuHS3+z5RgY+YBR6V1Z1nxSOfoaPa4LASWxxdNp+VWTk7+4vzaou8v8PN+xo+KY2xsw6une2frhw05CTYOmQvsEhjhWjn0bmXPjpE1+kplmmkP3suftwTubK9Vq22qKmrBhpY4jvd5afdRA3wGjFAgcnTK2s4hY0/GPNIb0nErGMCRxWOOX64Z8RAC4oCXdklmEvcL8o0BfkNK4lUg9HTl+oPlQxdNo3Mg4Nv175e/1LDGzZen30MEjRUtmXSfiTVu1kK8W4txyV6BMKlbgk3lMwYCiusNy9fVfvvwMxv8Ynl6vxoByANLTWplvuj/nF9m2+PDtt1eiHPBr1oIfhCChQMBw6Aw0UulqTKZdfVvfG7VcfIqLG9bcldL/+pdWTLxLUy8Qq38heUIjh4XlzZxzQm19lLFlr8vdQ97rjZVOLf8nclzckbcD4wxXMidpX30sFd37Fv/GtwwhzhxGVAprjbg0gCAEeIgwCZyTV2Z1REEW8O4py0wsjeloKoMr6iCY6dP92H6Vw/oTyICIthibxjm/DfN9lVz8IqtqKYLUXfoKVMVQVVJOElGjrnnUt9T9wbgp8AyYKaGlqingHZU/uG2NTZSVqwHQTWkx9hxjkpWDaCg6Ckj5qebgBVbT3V3NNXMSiWSDdGV3hrtzla7J+duwPOToIg42ChPQOQjspnSlp1V+Gjdged7+8UN5CRAV7a5EdFNwCjEaBR27b3W890TE7g24NAP/mMDXRWrGoFPQI9ls/MWO2dWFAar/xcOIImbbpA3zgAAAABJRU5ErkJggg==);
        }
    </style>
    <div>
        <a href="https://bokeh.org" target="_blank" class="bk-notebook-logo"></a>
        <span id="p1001">Loading BokehJS ...</span>
    </div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="output_javascript"></div>
<script type="text/javascript">
var element = document.currentScript.previousSibling.previousSibling;
(function(root) {
  function now() {
    return new Date();
  }

  const force = true;

  if (typeof root._bokeh_onload_callbacks === "undefined" || force === true) {
    root._bokeh_onload_callbacks = [];
    root._bokeh_is_loading = undefined;
  }

const JS_MIME_TYPE = 'application/javascript';
  const HTML_MIME_TYPE = 'text/html';
  const EXEC_MIME_TYPE = 'application/vnd.bokehjs_exec.v0+json';
  const CLASS_NAME = 'output_bokeh rendered_html';

  /**
   * Render data to the DOM node
   */
  function render(props, node) {
    const script = document.createElement("script");
    node.appendChild(script);
  }

  /**
   * Handle when an output is cleared or removed
   */
  function handleClearOutput(event, handle) {
    const cell = handle.cell;

    const id = cell.output_area._bokeh_element_id;
    const server_id = cell.output_area._bokeh_server_id;
    // Clean up Bokeh references
    if (id != null && id in Bokeh.index) {
      Bokeh.index[id].model.document.clear();
      delete Bokeh.index[id];
    }

    if (server_id !== undefined) {
      // Clean up Bokeh references
      const cmd_clean = "from bokeh.io.state import curstate; print(curstate().uuid_to_server['" + server_id + "'].get_sessions()[0].document.roots[0]._id)";
      cell.notebook.kernel.execute(cmd_clean, {
        iopub: {
          output: function(msg) {
            const id = msg.content.text.trim();
            if (id in Bokeh.index) {
              Bokeh.index[id].model.document.clear();
              delete Bokeh.index[id];
            }
          }
        }
      });
      // Destroy server and session
      const cmd_destroy = "import bokeh.io.notebook as ion; ion.destroy_server('" + server_id + "')";
      cell.notebook.kernel.execute(cmd_destroy);
    }
  }

  /**
   * Handle when a new output is added
   */
  function handleAddOutput(event, handle) {
    const output_area = handle.output_area;
    const output = handle.output;

    // limit handleAddOutput to display_data with EXEC_MIME_TYPE content only
    if ((output.output_type != "display_data") || (!Object.prototype.hasOwnProperty.call(output.data, EXEC_MIME_TYPE))) {
      return
    }

    const toinsert = output_area.element.find("." + CLASS_NAME.split(' ')[0]);

    if (output.metadata[EXEC_MIME_TYPE]["id"] !== undefined) {
      toinsert[toinsert.length - 1].firstChild.textContent = output.data[JS_MIME_TYPE];
      // store reference to embed id on output_area
      output_area._bokeh_element_id = output.metadata[EXEC_MIME_TYPE]["id"];
    }
    if (output.metadata[EXEC_MIME_TYPE]["server_id"] !== undefined) {
      const bk_div = document.createElement("div");
      bk_div.innerHTML = output.data[HTML_MIME_TYPE];
      const script_attrs = bk_div.children[0].attributes;
      for (let i = 0; i < script_attrs.length; i++) {
        toinsert[toinsert.length - 1].firstChild.setAttribute(script_attrs[i].name, script_attrs[i].value);
        toinsert[toinsert.length - 1].firstChild.textContent = bk_div.children[0].textContent
      }
      // store reference to server id on output_area
      output_area._bokeh_server_id = output.metadata[EXEC_MIME_TYPE]["server_id"];
    }
  }

  function register_renderer(events, OutputArea) {

    function append_mime(data, metadata, element) {
      // create a DOM node to render to
      const toinsert = this.create_output_subarea(
        metadata,
        CLASS_NAME,
        EXEC_MIME_TYPE
      );
      this.keyboard_manager.register_events(toinsert);
      // Render to node
      const props = {data: data, metadata: metadata[EXEC_MIME_TYPE]};
      render(props, toinsert[toinsert.length - 1]);
      element.append(toinsert);
      return toinsert
    }

    /* Handle when an output is cleared or removed */
    events.on('clear_output.CodeCell', handleClearOutput);
    events.on('delete.Cell', handleClearOutput);

    /* Handle when a new output is added */
    events.on('output_added.OutputArea', handleAddOutput);

    /**
     * Register the mime type and append_mime function with output_area
     */
    OutputArea.prototype.register_mime_type(EXEC_MIME_TYPE, append_mime, {
      /* Is output safe? */
      safe: true,
      /* Index of renderer in `output_area.display_order` */
      index: 0
    });
  }

  // register the mime type if in Jupyter Notebook environment and previously unregistered
  if (root.Jupyter !== undefined) {
    const events = require('base/js/events');
    const OutputArea = require('notebook/js/outputarea').OutputArea;

    if (OutputArea.prototype.mime_types().indexOf(EXEC_MIME_TYPE) == -1) {
      register_renderer(events, OutputArea);
    }
  }
  if (typeof (root._bokeh_timeout) === "undefined" || force === true) {
    root._bokeh_timeout = Date.now() + 5000;
    root._bokeh_failed_load = false;
  }

  const NB_LOAD_WARNING = {'data': {'text/html':
     "<div style='background-color: #fdd'>\n"+
     "<p>\n"+
     "BokehJS does not appear to have successfully loaded. If loading BokehJS from CDN, this \n"+
     "may be due to a slow or bad network connection. Possible fixes:\n"+
     "</p>\n"+
     "<ul>\n"+
     "<li>re-rerun `output_notebook()` to attempt to load from CDN again, or</li>\n"+
     "<li>use INLINE resources instead, as so:</li>\n"+
     "</ul>\n"+
     "<code>\n"+
     "from bokeh.resources import INLINE\n"+
     "output_notebook(resources=INLINE)\n"+
     "</code>\n"+
     "</div>"}};

  function display_loaded() {
    const el = document.getElementById("p1001");
    if (el != null) {
      el.textContent = "BokehJS is loading...";
    }
    if (root.Bokeh !== undefined) {
      if (el != null) {
        el.textContent = "BokehJS " + root.Bokeh.version + " successfully loaded.";
      }
    } else if (Date.now() < root._bokeh_timeout) {
      setTimeout(display_loaded, 100)
    }
  }

  function run_callbacks() {
    try {
      root._bokeh_onload_callbacks.forEach(function(callback) {
        if (callback != null)
          callback();
      });
    } finally {
      delete root._bokeh_onload_callbacks
    }
    console.debug("Bokeh: all callbacks have finished");
  }

  function load_libs(css_urls, js_urls, callback) {
    if (css_urls == null) css_urls = [];
    if (js_urls == null) js_urls = [];

    root._bokeh_onload_callbacks.push(callback);
    if (root._bokeh_is_loading > 0) {
      console.debug("Bokeh: BokehJS is being loaded, scheduling callback at", now());
      return null;
    }
    if (js_urls == null || js_urls.length === 0) {
      run_callbacks();
      return null;
    }
    console.debug("Bokeh: BokehJS not loaded, scheduling load and callback at", now());
    root._bokeh_is_loading = css_urls.length + js_urls.length;

    function on_load() {
      root._bokeh_is_loading--;
      if (root._bokeh_is_loading === 0) {
        console.debug("Bokeh: all BokehJS libraries/stylesheets loaded");
        run_callbacks()
      }
    }

    function on_error(url) {
      console.error("failed to load " + url);
    }

    for (let i = 0; i < css_urls.length; i++) {
      const url = css_urls[i];
      const element = document.createElement("link");
      element.onload = on_load;
      element.onerror = on_error.bind(null, url);
      element.rel = "stylesheet";
      element.type = "text/css";
      element.href = url;
      console.debug("Bokeh: injecting link tag for BokehJS stylesheet: ", url);
      document.body.appendChild(element);
    }

    for (let i = 0; i < js_urls.length; i++) {
      const url = js_urls[i];
      const element = document.createElement('script');
      element.onload = on_load;
      element.onerror = on_error.bind(null, url);
      element.async = false;
      element.src = url;
      console.debug("Bokeh: injecting script tag for BokehJS library: ", url);
      document.head.appendChild(element);
    }
  };

  function inject_raw_css(css) {
    const element = document.createElement("style");
    element.appendChild(document.createTextNode(css));
    document.body.appendChild(element);
  }

  const js_urls = ["https://cdn.bokeh.org/bokeh/release/bokeh-3.0.2.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-gl-3.0.2.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-widgets-3.0.2.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-tables-3.0.2.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-mathjax-3.0.2.min.js"];
  const css_urls = [];

  const inline_js = [    function(Bokeh) {
      Bokeh.set_log_level("info");
    },
function(Bokeh) {
    }
  ];

  function run_inline_js() {
    if (root.Bokeh !== undefined || force === true) {
          for (let i = 0; i < inline_js.length; i++) {
      inline_js[i].call(root, root.Bokeh);
    }
if (force === true) {
        display_loaded();
      }} else if (Date.now() < root._bokeh_timeout) {
      setTimeout(run_inline_js, 100);
    } else if (!root._bokeh_failed_load) {
      console.log("Bokeh: BokehJS failed to load within specified timeout.");
      root._bokeh_failed_load = true;
    } else if (force !== true) {
      const cell = $(document.getElementById("p1001")).parents('.cell').data().cell;
      cell.output_area.append_execute_result(NB_LOAD_WARNING)
    }
  }

  if (root._bokeh_is_loading === 0) {
    console.debug("Bokeh: BokehJS loaded, going straight to plotting");
    run_inline_js();
  } else {
    load_libs(css_urls, js_urls, function() {
      console.debug("Bokeh: BokehJS plotting callback run at", now());
      run_inline_js();
    });
  }
}(window));
</script></div>
</div>
<section id="Run-Cloud-Free-3D-Spectra">
<h2>Run Cloud-Free 3D Spectra<a class="headerlink" href="#Run-Cloud-Free-3D-Spectra" title="Link to this heading">¶</a></h2>
<p>By now you should have completed all the 3D inputs notebooks. This will just take you through completing the last step or running 3D spectra and analyzing your output.</p>
<p>Note most of the framework here follows the regular PICASO framework. If you need a refresher on the general workflow, please see earlier tutorials.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">opacity</span> <span class="o">=</span> <span class="n">jdi</span><span class="o">.</span><span class="n">opannection</span><span class="p">(</span><span class="n">wave_range</span><span class="o">=</span><span class="p">[</span><span class="mf">1.1</span><span class="p">,</span><span class="mf">1.7</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gcm_out</span> <span class="o">=</span>  <span class="n">jdi</span><span class="o">.</span><span class="n">HJ_pt_3d</span><span class="p">(</span><span class="n">as_xarray</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">case_3d</span> <span class="o">=</span> <span class="n">jdi</span><span class="o">.</span><span class="n">inputs</span><span class="p">()</span>
<span class="n">case_3d</span><span class="o">.</span><span class="n">phase_angle</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_gangle</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">num_tangle</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">case_3d</span><span class="o">.</span><span class="n">atmosphere_3d</span><span class="p">(</span><span class="n">gcm_out</span><span class="p">,</span><span class="n">regrid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">case_3d</span><span class="o">.</span><span class="n">chemeq_3d</span><span class="p">(</span><span class="n">n_cpu</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span> <span class="c1">#parallelize chemistry run</span>
<span class="n">case_3d</span><span class="o">.</span><span class="n">gravity</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">radius_unit</span><span class="o">=</span><span class="n">jdi</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="s1">&#39;R_jup&#39;</span><span class="p">),</span>
                <span class="n">mass</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mass_unit</span><span class="o">=</span><span class="n">jdi</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="s1">&#39;M_jup&#39;</span><span class="p">))</span> <span class="c1">#any astropy units available</span>
<span class="n">case_3d</span><span class="o">.</span><span class="n">star</span><span class="p">(</span><span class="n">opacity</span><span class="p">,</span><span class="mi">5000</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">4.0</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">radius_unit</span><span class="o">=</span><span class="n">jdi</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="s1">&#39;R_sun&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/nbatalh1/anaconda3/envs/pic311/lib/python3.11/site-packages/xesmf/smm.py:131: UserWarning: Input array is not C_CONTIGUOUS. Will affect performance.
  warnings.warn(&#39;Input array is not C_CONTIGUOUS. &#39; &#39;Will affect performance.&#39;)
</pre></div></div>
</div>
<section id="Predicting-Compute-Runtimes-for-3D-Calculations">
<h3>Predicting Compute Runtimes for 3D Calculations<a class="headerlink" href="#Predicting-Compute-Runtimes-for-3D-Calculations" title="Link to this heading">¶</a></h3>
<p>The speed of the code will be nearly directly proportional to the number of gangles and tangles as on radiative transfer calculation has to be computed for each facet of the “disco ball”.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">out3d</span> <span class="o">=</span> <span class="n">case_3d</span><span class="o">.</span><span class="n">spectrum</span><span class="p">(</span><span class="n">opacity</span><span class="p">,</span><span class="n">calculation</span><span class="o">=</span><span class="s1">&#39;thermal&#39;</span><span class="p">,</span><span class="n">dimension</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">,</span><span class="n">full_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="Analyze-3D-Spectra">
<h2>Analyze 3D Spectra<a class="headerlink" href="#Analyze-3D-Spectra" title="Link to this heading">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#same old same old</span>
<span class="n">wno</span><span class="p">,</span><span class="n">fpfs</span> <span class="o">=</span> <span class="n">jdi</span><span class="o">.</span><span class="n">mean_regrid</span><span class="p">(</span><span class="n">out3d</span><span class="p">[</span><span class="s1">&#39;wavenumber&#39;</span><span class="p">],</span><span class="n">out3d</span><span class="p">[</span><span class="s1">&#39;fpfs_thermal&#39;</span><span class="p">],</span><span class="n">R</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">jpi</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">jpi</span><span class="o">.</span><span class="n">spectrum</span><span class="p">(</span><span class="n">wno</span><span class="p">,</span> <span class="n">fpfs</span><span class="o">*</span><span class="mf">1e6</span><span class="p">,</span> <span class="n">plot_width</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span><span class="n">y_axis_type</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div id="fe1d50f3-0cdd-4d56-9825-b0a130081e5c" data-root-id="p1002" style="display: contents;"></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="output_javascript"></div>
<script type="text/javascript">
var element = document.currentScript.previousSibling.previousSibling;
(function(root) {
  function embed_document(root) {
  const docs_json = {"a89bb823-70d0-414d-9fd5-11154e64bfd6":{"version":"3.0.2","title":"Bokeh Application","defs":[],"roots":[{"type":"object","name":"Figure","id":"p1002","attributes":{"width":500,"height":345,"x_range":{"type":"object","name":"DataRange1d","id":"p1003"},"y_range":{"type":"object","name":"DataRange1d","id":"p1004"},"x_scale":{"type":"object","name":"LinearScale","id":"p1015"},"y_scale":{"type":"object","name":"LogScale","id":"p1017"},"title":{"type":"object","name":"Title","id":"p1009"},"renderers":[{"type":"object","name":"GlyphRenderer","id":"p1054","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1048","attributes":{"selected":{"type":"object","name":"Selection","id":"p1050","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1049"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"gEayYJkx+z8nt11ZVOz6PypOvMS/p/o/rFxY4dlj+j8+GDXyoCD6P5I2wz4T3vk/G6bVEi+c+T9/Y5a+8lr5P2tre5ZcGvk/mcg782ra+D+vvcQxHJv4P8IKL7NuXPg/KE603GAe+D9SgKQX8eD3P4KKW9EdpPc/7/c2e+Vn9z8/wYuKRiz3P/MxnHg/8fY/leeNws629j9f6l/p8nz2Px/f4HGqQ/Y/E1Kl5PMK9j99Gv7NzdL1P7nW7r02m/U/h4AkSC1k9T9bGewDsC31P29uKYy99/Q/VvRNf1TC9D/duU9/c430P/dxoDEZWfQ/fZQkP0Ql9D+PlSpU8/HzP0UzYiAlv/M/m9nTVtiM8z83HNitC1vzP/dFD9+9KfM/8v1Yp+348j/IAczGmcjyPwj1rQDBmPI/YUVrG2Jp8j+SI4/gezryP7+QuxwNDPI/B4ChnxTe8T8fDPk7kbDxPw=="},"shape":[44],"dtype":"float64","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"YjMMZ5WPZECZRzv5C1lkQHtv9oYMNmNAdW9KH6reYkC96c3ZGWBhQEuNvzOVi2BAb7YL+ok0XkABU5rHKkVbQJWDvOYfQ1hAsHDByQJkVUD3eHPAIPJRQHZSGbLDBlFA7cvoxwwNTUCi1ocAJ+JLQOC2CGF23UVAZqNEqhrPRUDCO/wOJbhDQCBH/Lu3sD1ACr4a3KCiQUCo9kq6Y1RBQJ5GLSjss0FAyYGCvT3hPkBOvp3UUEpBQK0XhN2GOEFAdyOz+bjLREB4R9SRXu9TQKrx3Ox0t1dAeHD6+1hxV0AViKFeGA1YQFrE0FP6n1ZApT/m6JUPVkAGOGObK1xTQBO9lZxqDFNAQYe5RXzIUECwoQk/2PFMQIBhLun1cklArtOTRkWNSEDHXULhywFDQNz2IDdpLURAlPkgvLChQ0AXAjMOlftAQJyvsX28UUNA/J1mQUG1QkBA17RlKSdEQA=="},"shape":[44],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1055","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1056"}}},"glyph":{"type":"object","name":"Line","id":"p1051","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#0072B2","line_width":3}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1052","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#0072B2","line_alpha":0.1,"line_width":3}},"muted_glyph":{"type":"object","name":"Line","id":"p1053","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#0072B2","line_alpha":0.2,"line_width":3}}}}],"toolbar":{"type":"object","name":"Toolbar","id":"p1010","attributes":{"tools":[{"type":"object","name":"PanTool","id":"p1033"},{"type":"object","name":"WheelZoomTool","id":"p1034"},{"type":"object","name":"BoxZoomTool","id":"p1035","attributes":{"overlay":{"type":"object","name":"BoxAnnotation","id":"p1036","attributes":{"syncable":false,"level":"overlay","visible":false,"left_units":"canvas","right_units":"canvas","bottom_units":"canvas","top_units":"canvas","line_color":"black","line_alpha":1.0,"line_width":2,"line_dash":[4,4],"fill_color":"lightgrey","fill_alpha":0.5}}}},{"type":"object","name":"SaveTool","id":"p1037"},{"type":"object","name":"ResetTool","id":"p1038"},{"type":"object","name":"HelpTool","id":"p1039"}]}},"left":[{"type":"object","name":"LogAxis","id":"p1026","attributes":{"ticker":{"type":"object","name":"LogTicker","id":"p1027","attributes":{"num_minor_ticks":10,"mantissas":[1,5]}},"formatter":{"type":"object","name":"LogTickFormatter","id":"p1029"},"axis_label":"Spectrum","axis_label_text_font":"times","axis_label_text_font_size":"14pt","axis_label_text_font_style":"bold","major_label_policy":{"type":"object","name":"AllLabels","id":"p1028"},"major_label_text_font":"times","major_label_text_font_size":"14pt"}}],"below":[{"type":"object","name":"LinearAxis","id":"p1019","attributes":{"ticker":{"type":"object","name":"BasicTicker","id":"p1020","attributes":{"mantissas":[1,2,5]}},"formatter":{"type":"object","name":"BasicTickFormatter","id":"p1022"},"axis_label":"Wavelength [\u03bcm]","axis_label_text_font":"times","axis_label_text_font_size":"14pt","axis_label_text_font_style":"bold","major_label_policy":{"type":"object","name":"AllLabels","id":"p1021"},"major_label_text_font":"times","major_label_text_font_size":"14pt"}}],"center":[{"type":"object","name":"Grid","id":"p1025","attributes":{"axis":{"id":"p1019"}}},{"type":"object","name":"Grid","id":"p1032","attributes":{"dimension":1,"axis":{"id":"p1026"}}}]}}]}};
  const render_items = [{"docid":"a89bb823-70d0-414d-9fd5-11154e64bfd6","roots":{"p1002":"fe1d50f3-0cdd-4d56-9825-b0a130081e5c"},"root_ids":["p1002"]}];
  root.Bokeh.embed.embed_items_notebook(docs_json, render_items);
  }
  if (root.Bokeh !== undefined) {
    embed_document(root);
  } else {
    let attempts = 0;
    const timer = setInterval(function(root) {
      if (root.Bokeh !== undefined) {
        clearInterval(timer);
        embed_document(root);
      } else {
        attempts++;
        if (attempts > 100) {
          clearInterval(timer);
          console.log("Bokeh: ERROR: Unable to run BokehJS code because BokehJS library is missing");
        }
      }
    }, 10, root)
  }
})(window);
</script></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jpi</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">jpi</span><span class="o">.</span><span class="n">flux_at_top</span><span class="p">(</span><span class="n">out3d</span> <span class="p">,</span>
                     <span class="n">pressures</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.8</span><span class="p">],</span>
                     <span class="n">ng</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">nt</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                     <span class="n">plot_height</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">plot_width</span><span class="o">=</span><span class="mi">500</span><span class="p">))</span><span class="c1">#note the addition of ng and nt</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div id="50c43e32-357c-4195-a22b-c9c9af39177b" data-root-id="p1146" style="display: contents;"></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="output_javascript"></div>
<script type="text/javascript">
var element = document.currentScript.previousSibling.previousSibling;
(function(root) {
  function embed_document(root) {
  const docs_json = {"c276c509-d53c-4808-b15c-c99492deb021":{"version":"3.0.2","title":"Bokeh Application","defs":[],"roots":[{"type":"object","name":"Figure","id":"p1146","attributes":{"width":500,"height":500,"x_range":{"type":"object","name":"DataRange1d","id":"p1148"},"y_range":{"type":"object","name":"DataRange1d","id":"p1147"},"x_scale":{"type":"object","name":"LogScale","id":"p1160"},"y_scale":{"type":"object","name":"LogScale","id":"p1162"},"title":{"type":"object","name":"Title","id":"p1149","attributes":{"text":"Outgoing Thermal Radiation"}},"renderers":[{"type":"object","name":"GlyphRenderer","id":"p1199","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1193","attributes":{"selected":{"type":"object","name":"Selection","id":"p1195","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1194"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"gEayYJkx+z8nt11ZVOz6PypOvMS/p/o/rFxY4dlj+j8+GDXyoCD6P5I2wz4T3vk/G6bVEi+c+T9/Y5a+8lr5P2tre5ZcGvk/mcg782ra+D+vvcQxHJv4P8IKL7NuXPg/KE603GAe+D9SgKQX8eD3P4KKW9EdpPc/7/c2e+Vn9z8/wYuKRiz3P/MxnHg/8fY/leeNws629j9f6l/p8nz2Px/f4HGqQ/Y/E1Kl5PMK9j99Gv7NzdL1P7nW7r02m/U/h4AkSC1k9T9bGewDsC31P29uKYy99/Q/VvRNf1TC9D/duU9/c430P/dxoDEZWfQ/fZQkP0Ql9D+PlSpU8/HzP0UzYiAlv/M/m9nTVtiM8z83HNitC1vzP/dFD9+9KfM/8v1Yp+348j/IAczGmcjyPwj1rQDBmPI/YUVrG2Jp8j+SI4/gezryP7+QuxwNDPI/B4ChnxTe8T8fDPk7kbDxPw=="},"shape":[44],"dtype":"float64","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"Ub+ybq9rckIVlz7Hp11yQtg3tnjlGXJCYaxA/TJAckKnNxxQ/EZxQszAz+pZynBCjB9/GMpTb0JICgiYWjtsQmQe+iC+I2pCShJaGHGkZ0Kppzh8D0JkQumAqVuicGNCCmx6vU6FYEK1BDIEoVBgQgxdK3yw4VlCKqK5Xl1uWkKy9mBBkUtYQqzdRkB7m1JCTe1D6uFxVkKWy9GOQMVWQhcZ/zoc7FdCZbh6peEzVUL6TYrTpwNYQmU0SHO6flhCDsd1U/cAXkLoEX3i7SJtQl2wSdWWpHFChZSxH8jGcULf54jzMWByQlZ4e3QZ0HFCPa+xRrarcUIbu2aBKohvQl/9ndwJkG9CuqMgRORYbELIzTKmF5VoQte/Rxoe12VC47T+ZOt8ZUJYuwrt3RFhQmHmjlwkQ2JCIbt7SZAyYkJkWEDlQ4ZfQt/zqjrYQ2JCxnpo0GD7YUIeKiZpqnpjQg=="},"shape":[44],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1200","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1201"}}},"glyph":{"type":"object","name":"Line","id":"p1196","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_width":4}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1197","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_alpha":0.1,"line_width":4}},"muted_glyph":{"type":"object","name":"Line","id":"p1198","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_alpha":0.2,"line_width":4}}}},{"type":"object","name":"GlyphRenderer","id":"p1208","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1202","attributes":{"selected":{"type":"object","name":"Selection","id":"p1204","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1203"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"gEayYJkx+z8nt11ZVOz6PypOvMS/p/o/rFxY4dlj+j8+GDXyoCD6P5I2wz4T3vk/G6bVEi+c+T9/Y5a+8lr5P2tre5ZcGvk/mcg782ra+D+vvcQxHJv4P8IKL7NuXPg/KE603GAe+D9SgKQX8eD3P4KKW9EdpPc/7/c2e+Vn9z8/wYuKRiz3P/MxnHg/8fY/leeNws629j9f6l/p8nz2Px/f4HGqQ/Y/E1Kl5PMK9j99Gv7NzdL1P7nW7r02m/U/h4AkSC1k9T9bGewDsC31P29uKYy99/Q/VvRNf1TC9D/duU9/c430P/dxoDEZWfQ/fZQkP0Ql9D+PlSpU8/HzP0UzYiAlv/M/m9nTVtiM8z83HNitC1vzP/dFD9+9KfM/8v1Yp+348j/IAczGmcjyPwj1rQDBmPI/YUVrG2Jp8j+SI4/gezryP7+QuxwNDPI/B4ChnxTe8T8fDPk7kbDxPw=="},"shape":[44],"dtype":"float64","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"tDW5hMi0eEKJ1cjD2q14Qr48x4HLo3hCfaW8tZWWeEKAqIWJNYZ4QvQ0EWKocnhC2L3w5uxbeEIovC4JA0J4QpYBYAnsJHhCw8bkfKoEeEKo4U5SQuF3Qpck49S4undC9YosrxSRd0IpkZjsXWR3QrreFPqdNHdCWEKnpd8Bd0IW7PkcL8x2QgPM1uqZk3ZCugSO8y5YdkJiekRw/hl2QgqqKOkZ2XVCyCaNLpSVdUIEVOlQgU91Qpo4wpf2BnVC95B+dwq8dEJtliqG1G50QiNHMW9tH3RCwE4S5u7Nc0JVBh2Yc3pzQkdVOh0XJXNCKYzQ5/XNckLFms0zLXVyQn1C5fTaGnJCPxsSxB2/cUL5Z2nMFGJxQkzRUrffA3FC+SE2mJ6kcELkFbLXcURwQvhP4Dz0xm9CfCRUf7ADb0KVv+xGWj9uQqwC5GEzem1ChZO6cH20bELUHYa6ee5rQg=="},"shape":[44],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1209","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1210"}}},"glyph":{"type":"object","name":"Line","id":"p1205","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#000003","line_alpha":0.5,"line_width":4}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1206","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#000003","line_alpha":0.1,"line_width":4}},"muted_glyph":{"type":"object","name":"Line","id":"p1207","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#000003","line_alpha":0.2,"line_width":4}}}},{"type":"object","name":"GlyphRenderer","id":"p1237","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1231","attributes":{"selected":{"type":"object","name":"Selection","id":"p1233","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1232"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"gEayYJkx+z8nt11ZVOz6PypOvMS/p/o/rFxY4dlj+j8+GDXyoCD6P5I2wz4T3vk/G6bVEi+c+T9/Y5a+8lr5P2tre5ZcGvk/mcg782ra+D+vvcQxHJv4P8IKL7NuXPg/KE603GAe+D9SgKQX8eD3P4KKW9EdpPc/7/c2e+Vn9z8/wYuKRiz3P/MxnHg/8fY/leeNws629j9f6l/p8nz2Px/f4HGqQ/Y/E1Kl5PMK9j99Gv7NzdL1P7nW7r02m/U/h4AkSC1k9T9bGewDsC31P29uKYy99/Q/VvRNf1TC9D/duU9/c430P/dxoDEZWfQ/fZQkP0Ql9D+PlSpU8/HzP0UzYiAlv/M/m9nTVtiM8z83HNitC1vzP/dFD9+9KfM/8v1Yp+348j/IAczGmcjyPwj1rQDBmPI/YUVrG2Jp8j+SI4/gezryP7+QuxwNDPI/B4ChnxTe8T8fDPk7kbDxPw=="},"shape":[44],"dtype":"float64","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"QUkBM5+6XkLg51HaKlheQoBwfpct8l1CGkBc1MaIXUL3PDaaFxxdQhGGx4BCrFxCZi3Dm2s5XEKBe/RmuMNbQrAcBbFPS1tC53b4hFnQWkJfO20S/1JaQsoQuJRq01lCve3rOMdRWUJCY+YCQc5YQn6sd7EESVhC2tK/oT/CV0Lwl9uxHzpXQg0Z/SLTsFZC3kENe4gmVkKwI/RlbptVQs0dp5azD1VCf3YcqIaDVELUiET+FfdTQqEHKaePalNCbgJTPCHeUkIRWJjE91FSQh4RcZY/xlFC/Lv0OiQ7UUJQUZ9R0LBQQk9m/HRtJ1BCR/6sQEg+T0LBZw4tNzBOQgMSB5TzJE1CbMV8jMYcTEJcpPI09hdLQj1eNIzFFkpCTfMzTXQZSUJG2D7OPiBIQr3YquNdK0dCFnQWxgY7RkJlnVP8ak9FQpTJDkm4aERCaRs/nBiHQ0IhTGcIsqpCQg=="},"shape":[44],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1238","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1239"}}},"glyph":{"type":"object","name":"Line","id":"p1234","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#B53679","line_alpha":0.5,"line_width":4}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1235","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#B53679","line_alpha":0.1,"line_width":4}},"muted_glyph":{"type":"object","name":"Line","id":"p1236","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#B53679","line_alpha":0.2,"line_width":4}}}},{"type":"object","name":"GlyphRenderer","id":"p1270","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1264","attributes":{"selected":{"type":"object","name":"Selection","id":"p1266","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1265"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"gEayYJkx+z8nt11ZVOz6PypOvMS/p/o/rFxY4dlj+j8+GDXyoCD6P5I2wz4T3vk/G6bVEi+c+T9/Y5a+8lr5P2tre5ZcGvk/mcg782ra+D+vvcQxHJv4P8IKL7NuXPg/KE603GAe+D9SgKQX8eD3P4KKW9EdpPc/7/c2e+Vn9z8/wYuKRiz3P/MxnHg/8fY/leeNws629j9f6l/p8nz2Px/f4HGqQ/Y/E1Kl5PMK9j99Gv7NzdL1P7nW7r02m/U/h4AkSC1k9T9bGewDsC31P29uKYy99/Q/VvRNf1TC9D/duU9/c430P/dxoDEZWfQ/fZQkP0Ql9D+PlSpU8/HzP0UzYiAlv/M/m9nTVtiM8z83HNitC1vzP/dFD9+9KfM/8v1Yp+348j/IAczGmcjyPwj1rQDBmPI/YUVrG2Jp8j+SI4/gezryP7+QuxwNDPI/B4ChnxTe8T8fDPk7kbDxPw=="},"shape":[44],"dtype":"float64","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"K9bSEIpTVkIEo/fMG/pVQkxzCGBznlVCozvCAq9AVUIwxyvk7eBUQsvWFxdQf1RCbqfBfvYbVEJZ6pO6ArdTQu2CKxGXUFNCZZmoWtboUkKMuWHq439SQqPGDXjjFVJCQol6CPmqUULQfebVSD9RQv1QFTj30lBCcB83jChmUEJdMHY5AvJPQtIUTRJKF09CsFgTXHA8TkJAHFcavGFNQgVRDWxzh0xCvaNeXdutS0LrL3q6N9VKQvYVn+PK/UlC8d6MotUnSULIHokBl1NIQhEDJyRMgUdCZHP7ITCxRkKKFWbje+NFQqH5lABmGEVCet7loiJQRELm9cRo44pDQhDNJUzXyEJCA46viyoKQkKFLrKWBk9BQi9h9vuRl0BCdnHstuDHP0Kp7BC2hGg+QtPZCDxLET1C86DAf2nCO0JHW4+jDnw6QplkR7ZjPjlC2c4VuosJOEItDxSxo902Qg=="},"shape":[44],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1271","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1272"}}},"glyph":{"type":"object","name":"Line","id":"p1267","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#FBFCBF","line_alpha":0.5,"line_width":4}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1268","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#FBFCBF","line_alpha":0.1,"line_width":4}},"muted_glyph":{"type":"object","name":"Line","id":"p1269","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#FBFCBF","line_alpha":0.2,"line_width":4}}}}],"toolbar":{"type":"object","name":"Toolbar","id":"p1155","attributes":{"tools":[{"type":"object","name":"PanTool","id":"p1178"},{"type":"object","name":"WheelZoomTool","id":"p1179"},{"type":"object","name":"BoxZoomTool","id":"p1180","attributes":{"overlay":{"type":"object","name":"BoxAnnotation","id":"p1181","attributes":{"syncable":false,"level":"overlay","visible":false,"left_units":"canvas","right_units":"canvas","bottom_units":"canvas","top_units":"canvas","line_color":"black","line_alpha":1.0,"line_width":2,"line_dash":[4,4],"fill_color":"lightgrey","fill_alpha":0.5}}}},{"type":"object","name":"SaveTool","id":"p1182"},{"type":"object","name":"ResetTool","id":"p1183"},{"type":"object","name":"HelpTool","id":"p1184"}]}},"left":[{"type":"object","name":"LogAxis","id":"p1171","attributes":{"ticker":{"type":"object","name":"LogTicker","id":"p1172","attributes":{"num_minor_ticks":10,"mantissas":[1,5]}},"formatter":{"type":"object","name":"LogTickFormatter","id":"p1174"},"axis_label":"Flux (erg/s/cm^3)","major_label_policy":{"type":"object","name":"AllLabels","id":"p1173"}}}],"below":[{"type":"object","name":"LogAxis","id":"p1164","attributes":{"ticker":{"type":"object","name":"LogTicker","id":"p1165","attributes":{"num_minor_ticks":10,"mantissas":[1,5]}},"formatter":{"type":"object","name":"LogTickFormatter","id":"p1167"},"axis_label":"Wavelength [\u03bcm]","major_label_policy":{"type":"object","name":"AllLabels","id":"p1166"}}}],"center":[{"type":"object","name":"Grid","id":"p1170","attributes":{"axis":{"id":"p1164"}}},{"type":"object","name":"Grid","id":"p1177","attributes":{"dimension":1,"axis":{"id":"p1171"}}},{"type":"object","name":"Legend","id":"p1229","attributes":{"items":[{"type":"object","name":"LegendItem","id":"p1230","attributes":{"label":{"type":"value","value":"1675 K at 5 bars"},"renderers":[{"id":"p1208"}]}},{"type":"object","name":"LegendItem","id":"p1263","attributes":{"label":{"type":"value","value":"1361 K at 1 bars"},"renderers":[{"id":"p1237"}]}},{"type":"object","name":"LegendItem","id":"p1301","attributes":{"label":{"type":"value","value":"1295 K at 0.8 bars"},"renderers":[{"id":"p1270"}]}}]}}]}}]}};
  const render_items = [{"docid":"c276c509-d53c-4808-b15c-c99492deb021","roots":{"p1146":"50c43e32-357c-4195-a22b-c9c9af39177b"},"root_ids":["p1146"]}];
  root.Bokeh.embed.embed_items_notebook(docs_json, render_items);
  }
  if (root.Bokeh !== undefined) {
    embed_document(root);
  } else {
    let attempts = 0;
    const timer = setInterval(function(root) {
      if (root.Bokeh !== undefined) {
        clearInterval(timer);
        embed_document(root);
      } else {
        attempts++;
        if (attempts > 100) {
          clearInterval(timer);
          console.log("Bokeh: ERROR: Unable to run BokehJS code because BokehJS library is missing");
        }
      }
    }, 10, root)
  }
})(window);
</script></div>
</div>
<section id="3D-Map-of-Flux">
<h3>3D Map of Flux<a class="headerlink" href="#3D-Map-of-Flux" title="Link to this heading">¶</a></h3>
<p>We can use the same plot as we used for reflected light. In 3D this plot is quite a bit more interesting since we can see variations across the disk from out input file.</p>
<p>Note below I specify thermal. The default is reflected, I just chose this as an example.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jpi</span><span class="o">.</span><span class="n">disco</span><span class="p">(</span><span class="n">out3d</span><span class="p">[</span><span class="s1">&#39;full_output&#39;</span><span class="p">]</span> <span class="p">,</span><span class="n">wavelength</span><span class="o">=</span><span class="p">[</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">],</span> <span class="n">calculation</span><span class="o">=</span><span class="s1">&#39;thermal&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_9d_3DSpectra_11_0.png" src="../_images/notebooks_9d_3DSpectra_11_0.png" />
</div>
</div>
</section>
<section id="3D-Map-of-Gas-Opacity-Sources">
<h3>3D Map of Gas Opacity Sources<a class="headerlink" href="#3D-Map-of-Gas-Opacity-Sources" title="Link to this heading">¶</a></h3>
<p>In addition to disco there is a general map function that can plot anything in <code class="docutils literal notranslate"><span class="pre">picaso</span></code>’s full output dict. Below is an example of the <code class="docutils literal notranslate"><span class="pre">taugas</span></code> where we must specify both a pressure and wavelength to plot the map</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Since Taugas is [nlayer, nwave, nlong, nlat] we can specify a list of pressures and a SINGLE wavelength.</span>
<span class="n">jpi</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">out3d</span><span class="p">[</span><span class="s1">&#39;full_output&#39;</span><span class="p">],</span><span class="n">plot</span><span class="o">=</span><span class="s1">&#39;taugas&#39;</span><span class="p">,</span><span class="n">pressure</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.8</span><span class="p">],</span><span class="n">wavelength</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_9d_3DSpectra_13_0.png" src="../_images/notebooks_9d_3DSpectra_13_0.png" />
</div>
</div>
</section>
</section>
<section id="Run-Cloudy-3D-Spectra">
<h2>Run Cloudy 3D Spectra<a class="headerlink" href="#Run-Cloudy-3D-Spectra" title="Link to this heading">¶</a></h2>
<p>If you have not already, please consult the tutorial on post-processing cloud inputs. Below, we will use <code class="docutils literal notranslate"><span class="pre">virga</span></code> to post-process clouds on our example GCM input.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gcm_out</span> <span class="o">=</span>  <span class="n">jdi</span><span class="o">.</span><span class="n">HJ_pt_3d</span><span class="p">(</span><span class="n">as_xarray</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">add_kz</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">case_3d</span> <span class="o">=</span> <span class="n">jdi</span><span class="o">.</span><span class="n">inputs</span><span class="p">()</span>
<span class="n">case_3d</span><span class="o">.</span><span class="n">phase_angle</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_tangle</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">num_gangle</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">case_3d</span><span class="o">.</span><span class="n">atmosphere_3d</span><span class="p">(</span><span class="n">gcm_out</span><span class="p">,</span> <span class="n">regrid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">case_3d</span><span class="o">.</span><span class="n">gravity</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">radius_unit</span><span class="o">=</span><span class="n">jdi</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="s1">&#39;R_jup&#39;</span><span class="p">),</span>
                <span class="n">mass</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mass_unit</span><span class="o">=</span><span class="n">jdi</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="s1">&#39;M_jup&#39;</span><span class="p">))</span> <span class="c1">#any astropy units available</span>
<span class="n">case_3d</span><span class="o">.</span><span class="n">star</span><span class="p">(</span><span class="n">opacity</span><span class="p">,</span><span class="mi">5000</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">4.0</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">radius_unit</span><span class="o">=</span><span class="n">jdi</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="s1">&#39;R_sun&#39;</span><span class="p">))</span>
<span class="n">case_3d</span><span class="o">.</span><span class="n">chemeq_3d</span><span class="p">(</span><span class="n">n_cpu</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">mieff_directory</span> <span class="o">=</span> <span class="s1">&#39;/data/virga/&#39;</span>
<span class="n">clds</span> <span class="o">=</span> <span class="n">case_3d</span><span class="o">.</span><span class="n">virga_3d</span><span class="p">([</span><span class="s1">&#39;MnS&#39;</span><span class="p">],</span> <span class="n">mieff_directory</span><span class="p">,</span><span class="n">fsed</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">kz_min</span><span class="o">=</span><span class="mf">1e10</span><span class="p">,</span>
                        <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">n_cpu</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">full_output</span><span class="o">=</span><span class="kc">True</span>
                       <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
verbose=True;regrid=True; Regridding 3D output to ngangle=10, ntangle=10, with phase=0.
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/nbatalh1/anaconda3/envs/pic311/lib/python3.11/site-packages/xesmf/smm.py:131: UserWarning: Input array is not C_CONTIGUOUS. Will affect performance.
  warnings.warn(&#39;Input array is not C_CONTIGUOUS. &#39; &#39;Will affect performance.&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_9d_3DSpectra_15_2.png" src="../_images/notebooks_9d_3DSpectra_15_2.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">out3d_cld</span> <span class="o">=</span> <span class="n">case_3d</span><span class="o">.</span><span class="n">spectrum</span><span class="p">(</span><span class="n">opacity</span><span class="p">,</span>
                             <span class="n">calculation</span><span class="o">=</span><span class="s1">&#39;thermal&#39;</span><span class="p">,</span><span class="n">dimension</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">,</span><span class="n">full_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<section id="3D-\tau~1-Pressure-Level-Map">
<h3>3D <span class="math notranslate nohighlight">\(\tau\)</span>~1 Pressure-Level Map<a class="headerlink" href="#3D-\tau~1-Pressure-Level-Map" title="Link to this heading">¶</a></h3>
<p>Here we can break down a full map of the molecular, cloud and rayleigh opacity. Whereas in map we had to specify a specific pressure and wavelength, here we can specify an optical depth and it will produce a map of what pressure level corresponds to that optical depth. We tend to see photons that originate from tau=1. Therefore, it is interesting to plot a tau=1 map so we can see if we are seeing different pressure levels at different locations across the disk.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#NOTE, we haven&#39;t run clouds and are not at short wavelenghts,</span>
<span class="c1">#so the cloud and rayleigh opacity will not be too interesting</span>
<span class="n">jpi</span><span class="o">.</span><span class="n">taumap</span><span class="p">(</span><span class="n">out3d_cld</span><span class="p">[</span><span class="s1">&#39;full_output&#39;</span><span class="p">],</span> <span class="n">wavelength</span><span class="o">=</span><span class="mf">1.4</span><span class="p">,</span> <span class="n">at_tau</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_9d_3DSpectra_18_0.png" src="../_images/notebooks_9d_3DSpectra_18_0.png" />
</div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="9c_PostProcess3Dinput-Clouds.html" class="btn btn-neutral float-left" title="Post-Process 3D Clouds Input" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="9e_PhaseCurves.html" class="btn btn-neutral float-right" title="Phase Curves Part 1" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright .</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>